<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>LightPivot Demos</title>
    <!-- build:css -->
    <link rel="stylesheet" href="../source/css/LightPivot.css"/>
    <!-- endbuild -->
    <!-- build:js -->
    <script type="text/javascript" src="../source/js/LightPivotTable.js"></script>
    <script type="text/javascript" src="../source/js/DataSource.js"></script>
    <script type="text/javascript" src="../source/js/PivotView.js"></script>
    <script type="text/javascript" src="../source/js/DataController.js"></script>
    <script type="text/javascript" src="../source/js/MDXParser.js"></script>
    <!-- endbuild -->
    <style>
        a {
            text-decoration: underline;
            color: blue;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="pivot" style="position: fixed; left: 20%; top: 30%; width: 60%; height: 60%;
    box-shadow: 0 0 20px rgb(135, 135, 135);">

    </div>
    <div>Variants:
        <a onclick="rSoon(this)">0</a>,
        <a onclick="rSoon(this)">1</a>,
        <a onclick="rSoon(this)">2</a>,
        <a onclick="rSoon(this)">3</a>,
        <a onclick="rSoon(this)">4</a>,
        <a onclick="rSoon(this)">5</a>,
        <a onclick="rSoon(this)">6</a>,
        <a onclick="rSoon(this)">7</a>,
        <a onclick="rSoon(this)">8</a>,
        <a onclick="rSoon(this)">9</a>,
        <a onclick="rSoon(this)">10</a>,
        <a onclick="rSoon(this)">11</a>
    </div>
    <div id="mdx"></div>
    <form id="mdxForm" onsubmit="return false;">
        <label>
            <br/>Your MDX:<br/>
            <input id="yourMDX" type="text" style="width: 100%"/>
        </label>
    </form>
    <script type="text/javascript">

        // reloads the page.
        var rSoon = function (o) {
            location.hash = "#" + o.textContent;
            setTimeout(function () { window.location.reload(true); }, 1);
        };

        var mdxTo = document.getElementById("mdx"),
            v = parseInt(location.hash.slice(1)) || 0,
            req = [
                "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0,NON EMPTY HEAD(NONEMPTYCROSSJOIN([Outlet].[H1].[Region].Members,[Outlet].[H1].[Country].Members),2000) ON 1 FROM [HoleFoods] %FILTER [Measures].[%COUNT]",
                "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0,NON EMPTY [DateOfSale].[Actual].[MonthSold].&[201003].children ON 1 FROM [HoleFoods] %FILTER [DateOfSale].[Actual].[YearSold].&[2010] %FILTER [DateOfSale].[Actual].[MonthSold].&[201003] %FILTER [Measures].[%COUNT]",
                "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0,NON EMPTY HEAD(NONEMPTYCROSSJOIN([DateOfSale].[Actual].[YearSold].Members,[DateOfSale].[Actual].[MonthSold].Members),2000) ON 1 FROM [HoleFoods] %FILTER [Measures].[%COUNT]",
                "SELECT NON EMPTY NONEMPTYCROSSJOIN([Product].[P1].[Product Category].Members,[Product].[P1].[Product Name].Members) ON 0,NON EMPTY HEAD(NONEMPTYCROSSJOIN([DateOfSale].[Actual].[YearSold].Members,[DateOfSale].[Actual].[MonthSold].Members),2000) ON 1 FROM [HoleFoods] %FILTER [Measures].[%COUNT]",
                "SELECT NON EMPTY NONEMPTYCROSSJOIN(NONEMPTYCROSSJOIN([Product].[P1].[Product Category].Members,[Product].[P1].[Product Name].Members),{%LABEL([Measures].[%COUNT],\"Кол-во\",\"\"),[Measures].[Units Sold]}) ON 0,NON EMPTY HEAD(NONEMPTYCROSSJOIN([DateOfSale].[Actual].[YearSold].Members,[DateOfSale].[Actual].[MonthSold].Members),2000) ON 1 FROM [HoleFoods]",
                "SELECT {[Measures].[%COUNT]} ON 0 FROM [HoleFoods] %FILTER [Measures].[%COUNT]",
                "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0,{[Measures].[%COUNT]} ON 1 FROM [HoleFoods] %FILTER [Measures].[%COUNT]",
                "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0, NON EMPTY [Outlet].[H1].[Region].Members ON 1 FROM [HoleFoods]",
                "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0,NON EMPTY [DateOfSale].[Actual].[YearSold].&[2010].children ON 1 FROM [HoleFoods] %FILTER [DateOfSale].[Actual].[YearSold].&[2010] %FILTER [Measures].[%COUNT]",
                "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0,NON EMPTY [DateOfSale].[Actual].[YearSold].Members ON 1 FROM [HoleFoods]",
                {
                    basicMDX: "SELECT NON EMPTY [Product].[P1].[Product Category].Members ON 0,NON EMPTY [DateOfSale].[Actual].[YearSold].Members ON 1 FROM [HoleFoods]",
                    DrillDownExpression: "NONEMPTYCROSSJOIN([Outlet].[H1].[Region].Members,[Outlet].[H1].[Country].Members)"
                },
                {
                    basicMDX: "SELECT NON EMPTY [Outlet]" +
                    ".[H1].[Region].Members ON 0,NON EMPTY [DateOfSale].[Actual].[YearSold].Members ON 1 FROM [HoleFoods]",
                    DrillDownExpression: "NONEMPTYCROSSJOIN([DateOfSale].[Actual].[YearSold].Members,[Product].[P1].[Product Category].Members)"
                }
            ][v],
            setup;

        if (location.hash.slice(1, 3) === "q=") {
            req = location.hash.slice(3);
        }

        setup = {
            container: document.getElementById("pivot"), // HTMLElement which will contain table.
            dataSource: {
                MDX2JSONSource: "http://localhost:57772/SAMPLES", // MDX2JSON server address
                basicMDX: typeof req === "object" ? req.basicMDX : req
                //[ , namespace: "SAMPLES" ] // current namespace : default namespace
                //[ , username: "USER" ] // user name : default user
                //[ , password: "" ] // user password : default password
            }
            //, caption: "My table" // if set, table basic caption will be replaced by this text
            //, DrillDownExpression: "<spec>" // @deprecated drillDown expression split by "^"
            //, showSummary: true // show summary by columns
            //, formatNumbers: "#,###.##" // @deprecated
            //, drillDownTarget: "<dashboard name>" // undocumented, deepSee only
        };

        if (req.DrillDownExpression) { // set custom DrillDown on variant 10
            setup.DrillDownExpression = req.DrillDownExpression;
            var e = document.createElement("div");
            e.innerHTML = "<b>Custom DrillDown expression set up here: </b>"
                + setup.DrillDownExpression;
            document.getElementById("mdxForm").appendChild(e);
        }

        document.getElementById("mdxForm").addEventListener("submit", function () {

            var yourMDX = document.getElementById("yourMDX").value;

            window.location.hash = "#q=" + yourMDX;

            window.location.reload(true);

        });

        mdxTo.innerHTML = "<b>Basic MDX:</b> <i>" + (typeof req === "object" ? req.basicMDX : req)
            + "</i>";

        console.log(setup);

        var lp = new LightPivotTable(setup); // create widget

    </script>
</body>
</html>